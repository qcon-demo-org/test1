name: IPFS Public Nodes Workflow

on:
  workflow_dispatch:
  
jobs:
  ipfs-public-nodes-job:
    runs-on: ubuntu-latest

    steps:
    - name: Harden Runner
      uses: step-security/harden-runner@rc
      with:
          egress-policy: audit
    - uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'

    - name: Install IPFS HTTP Client
      run: npm install ipfs-http-client@50.1.2

    - name: Interact with Public IPFS Node (No Auth)
      run: |
        node -e "
        const { create } = require('ipfs-http-client');

        async function main() {
          // Connect to a public IPFS gateway that doesn't require authentication
          const client = create({ url: 'https://ipfs.io' });

          try {
            // Fetch a known IPFS object (IPFS logo)
            const ipfsLogoCid = 'QmTkzDwWqPbnAh5YiV5VwcTLnGdwSNsNTn2aDxdXBFca7D';
            let logoContent = '';
            for await (const chunk of client.cat(ipfsLogoCid)) {
              logoContent += chunk.toString().slice(0, 100); // Just get the first 100 chars
            }
            console.log('IPFS Logo content (first 100 chars):', logoContent);

          } catch (error) {
            console.error('Error:', error.message);
          }
        }

        main().catch(console.error);
        "
